{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/basis_admin.css">
    <meta name="csrf-token" content="{% csrf_token %}">
    {% block link %}
    {% endblock %}
    {% block metascript %}
    {% endblock %}
    <title>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <script src="https://cdn.jsdelivr.net/gh/IonDen/ion.sound@3.0.7/js/ion.sound.min.js"></script>
</head>
<style>
    #global-loader {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 99999;
        opacity: 0;
        visibility: hidden;
        transition: .3s;
        font-family: Nunito, sans-serif;
    }

    #global-loader.active {
        opacity: 1;
        visibility: visible;
    }

    .loader-spinner {
        width: 60px;
        height: 60px;
        border: 6px solid #e0e0e0;
        border-top: 6px solid #2fd419;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-bottom: 15px;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>

<body>
    <div id="global-loader">
        <div class="loader-spinner"></div>
        <p>–ü–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
    </div>

    <header>
        <div class="sub-header">
            <nav class="header-nav">
                <ul>
                    <li><a href="{% url 'orders' %}"><span class="orders"></span> –ó–∞–∫–∞–∑—ã <p class="inProgressStatus">
                            </p></a></li>
                    <li><a href="{% url 'orders_chart' %}"><span class="orders_chart"></span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
                    <li><a href="{% url 'add_food' %}"><span class="add_food"></span> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a></li>
                    <li><a href="{% url 'edit_menu' %}"><span class="edit-menu"></span> –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</a></li>
                    <li><a href="{% url 'profile' %}"><span class="profile"></span> –ü—Ä–æ—Ñ–∏–ª—å</a></li>
                    {% if user.get_user_status_display == '–û–Ω–ª–∞–π–Ω' %}
                    <p class="online">–û—Ç–∫—Ä—ã—Ç–æ</p>
                    <div class="cheked">
                        <div class="toggle">
                            <input type="checkbox" class="check" checked>
                            <b class="b switch"></b>
                            <b class="b track"></b>
                        </div>
                    </div>
                    {% else %}
                    <p class="offline">–ó–∞–∫—Ä—ã—Ç–æ</p>
                    <div class="cheked">
                        <div class="toggle">
                            <input type="checkbox" class="check">
                            <b class="b switch"></b>
                            <b class="b track"></b>
                        </div>
                    </div>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>
    {% block main %}
    {% endblock %}
    <script src="/static/script/jquery-3.7.1.js"></script>
    <script src="/static/script/async.js"></script>

    <script>
        document.querySelectorAll('.check').forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                fetch("{% url 'toggle_user_status' %}", {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',  // CSRF-—Ç–æ–∫–µ–Ω
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})  // –ü—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                        }
                        return response.json();
                    })
                    .then(data => {
                        setTimeout(() => {
                            location.reload();
                        }, 400);
                    })
                    .catch(error => console.error('–û—à–∏–±–∫–∞:', error));

            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const loader = document.getElementById("global-loader");

            function showLoader() {
                loader.classList.add("active");
            }

            // üî• –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –õ–Æ–ë–û–ô —Ñ–æ—Ä–º—ã
            document.querySelectorAll("form").forEach(form => {
                form.addEventListener("submit", function () {
                    showLoader();
                });
            });

            // üî• –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –ª—é–±–æ–π —Å—Å—ã–ª–∫–µ
            document.querySelectorAll("a").forEach(link => {
                link.addEventListener("click", function () {
                    if (link.href && !link.href.includes("#")) {
                        showLoader();
                    }
                });
            });

            // –°–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener("load", function () {
                loader.classList.remove("active");
            });

        });
    </script>


    {% block script %}
    {% endblock %}
</body>

</html>